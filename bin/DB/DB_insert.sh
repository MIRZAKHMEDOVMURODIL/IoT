#!/bin/bash

CURR_DIR=/IoT/bin/DB
PY_STS=$CURR_DIR/db2_STS_r1.py
PY_STS_RAW=$CURR_DIR/db2_STS_raw_r1.py
PY_ALM=$CURR_DIR/db2_ALM_r1.py
PY_QC=$CURR_DIR/db2_QC_r1.py
PY_TS=$CURR_DIR/db2_TS_r1.py
PY_COUNT=$CURR_DIR/db2_COUNT_r1.py
PY_HOKYU=$CURR_DIR/db2_hokyu_r1.py
PY_CNDT=$CURR_DIR/db2_CNDT.py
SHNAME=$(basename "$0")
LCKNAME=/$SHNAME.lck
CONFIG_DIR=$CURR_DIR/config

#履歴登録(DB登録開始)
PROC_TYPE=DB
TIME=`date "+%Y-%m-%d %H:%M:%S"`
RESULT=0
NULL=\"\"
/IoT/bin/hist_append.sh ${PROC_TYPE} ${SHNAME} ${NULL} ${NULL} ${NULL} ${NULL} ${NULL} ${NULL} ${NULL} "${TIME}" ${RESULT} ${NULL}

# 多重起動防止
if [ -e $CURR_DIR/$LCKNAME ]; then
    exit 0
fi

touch $CURR_DIR/$LCKNAME

#DB2環境変数設定
cd /IoT/db2driver/dsdriver
. ./db2profile

#　PC設備のデータをDBへ書き込む
cd $CURR_DIR

EQPID=LEV50001
EQPNAME=MSAPシード剥離

# 000
UNIT_NUM=000
python3 $PY_STS $CONFIG_DIR/$UNIT_NUM/STS.json $EQPNAME

# 010
UNIT_NUM=010
python3 $PY_ALM $CONFIG_DIR/$UNIT_NUM/ALM.json $EQPNAME
python3 $PY_STS $CONFIG_DIR/$UNIT_NUM/STS.json $EQPNAME
python3 $PY_STS_RAW $CONFIG_DIR/$UNIT_NUM/STS_raw.json $EQPNAME
python3 $PY_COUNT $CONFIG_DIR/$UNIT_NUM/COUNT.json $EQPNAME

# 020
UNIT_NUM=020
python3 $PY_STS $CONFIG_DIR/$UNIT_NUM/STS.json $EQPNAME
python3 $PY_STS_RAW $CONFIG_DIR/$UNIT_NUM/STS_raw.json $EQPNAME
python3 $PY_ALM $CONFIG_DIR/$UNIT_NUM/ALM.json $EQPNAME
python3 $PY_TS $CONFIG_DIR/$UNIT_NUM/log1_TS.json $EQPNAME
python3 $PY_QC $CONFIG_DIR/$UNIT_NUM/log1_QC.json $EQPNAME
python3 $PY_QC $CONFIG_DIR/$UNIT_NUM/log2_QC.json $EQPNAME
python3 $PY_CNDT $CONFIG_DIR/$UNIT_NUM/Conductivity.json $EQPNAME

# 030
UNIT_NUM=030
python3 $PY_ALM $CONFIG_DIR/$UNIT_NUM/ALM.json $EQPNAME
python3 $PY_STS $CONFIG_DIR/$UNIT_NUM/STS.json $EQPNAME
python3 $PY_STS_RAW $CONFIG_DIR/$UNIT_NUM/STS_raw.json $EQPNAME
python3 $PY_COUNT $CONFIG_DIR/$UNIT_NUM/COUNT.json $EQPNAME

rm $CURR_DIR/$LCKNAME